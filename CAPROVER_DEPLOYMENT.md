# Развертывание бота мониторинга сайтов на CapRover

## Подготовка

1. Убедитесь, что у вас есть аккаунт на CapRover и доступ к панели управления.
2. Убедитесь, что ваш репозиторий GitHub подключен к CapRover.

## Шаги развертывания

### 1. Создание нового приложения

1. В панели CapRover нажмите "Create New App"
2. Введите имя приложения, например: `sitemonitor`
3. Нажмите "Create"

### 2. Настройка переменных окружения

1. Перейдите в созданное приложение
2. Нажмите "Config Vars"
3. Добавьте следующие переменные окружения:

```
API_TOKEN=your_telegram_bot_token
ADMIN_CHAT_ID=your_admin_chat_id
SUPABASE_URL=your_supabase_url
SUPABASE_KEY=your_supabase_key
ONLY_ADMIN_PUSH=false
DOWN_CHECK_ATTEMPTS=3
DOWN_CHECK_INTERVAL=10
DNS_ERROR_MULTIPLIER=2
ENABLE_ALTERNATIVE_CHECK=true
```

### 3. Настройка развертывания

1. В настройках приложения перейдите в раздел "Deploy"
2. Выберите "Deploy from GitHub Repository"
3. Выберите ваш репозиторий `botmonitor`
4. В разделе "Deployment Method" выберите "Using Captain Definition"
5. CapRover автоматически обнаружит файл `captain-definition.json` в вашем репозитории
6. Нажмите "Deploy"

### 4. Проверка развертывания

1. Дождитесь завершения развертывания
2. Проверьте логи приложения в разделе "Logs"
3. Убедитесь, что бот запустился и отправил стартовое сообщение администратору

## Возможные проблемы и решения

### Проблема: Ошибка зависимостей при сборке

**Решение:** Убедитесь, что в `requirements.txt` указана совместимая версия `python-dateutil>=2.9.0`

### Проблема: Бот не запускается

**Решение:** Проверьте логи приложения и убедитесь, что все переменные окружения установлены правильно.

### Проблема: Ошибка SSL/TLS

**Решение:** Убедитесь, что в CapRover включены SSL-сертификаты для вашего домена.

## Обновление приложения

Для обновления приложения до последей версии:

1. Сделайте коммит с изменениями в ваш репозиторий GitHub
2. В CapRover перейдите в приложение и нажмите "Deploy"
3. Выберите "Deploy from GitHub Repository"
4. Нажмите "Deploy" для обновления

## Мониторинг

1. В CapRover вы можете отслеживать состояние приложения в разделе "Logs"
2. Для получения уведомлений о работе бота настройте переменную `ADMIN_CHAT_ID`
3. Бот будет отправлять уведомления о проблемах с доступностью сайтов в указанный чат

## Дополнительная информация

- Бот автоматически проверяет сайты каждые 5-10 минут
- WHOIS проверка выполняется ежедневно в 10:00 UTC
- Для резервных доменов проверка доступности отключена
- Уведомления об истечении доменов и хостинга отправляются за 30, 14, 7, 6, 5, 4, 3, 2, 1 день до истечения