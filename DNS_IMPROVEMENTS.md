# Улучшения системы мониторинга для обработки DNS-ошибок

## Проблема
Бот мониторинга отправлял ложные уведомления о недоступности сайтов из-за временных DNS-сбоев:
- `[Errno -5] No address associated with hostname`
- `[Errno -3] Temporary failure in name resolution`

## Решение

### 1. Улучшенная функция проверки доступности

**Файл:** `main.py`
**Функции:** `check_site()`, `check_site_alternative()`, `check_site_with_retries()`

#### Основные улучшения:
- **Детектирование DNS-ошибок** с логированием конкретных ошибок
- **Альтернативные проверки** через ping и nslookup при множественных DNS-ошибках
- **Адаптивные интервалы** между проверками (увеличиваются при DNS-ошибках)
- **Умное количество попыток** с дополнительной проверкой перед отправкой уведомления

### 2. Новые параметры конфигурации

**Файл:** `.env`

```env
# Параметры проверки доступности сайтов
DOWN_CHECK_ATTEMPTS=4          # Количество попыток (было 3)
DOWN_CHECK_INTERVAL=15         # Интервал между попытками в секундах (было 10)
DNS_ERROR_MULTIPLIER=3         # Множитель интервала при DNS-ошибках
ENABLE_ALTERNATIVE_CHECK=True  # Включить альтернативные проверки
```

### 3. Алгоритм работы улучшенной системы

1. **Первая попытка:** Стандартная HTTP-проверка
2. **При ошибке:** Логирование и подсчет DNS-ошибок
3. **Множественные DNS-ошибки (2+):** Альтернативная проверка через ping/nslookup
4. **Адаптивный интервал:** Увеличивается при DNS-ошибках (15 сек × 3 = 45 сек)
5. **Финальное решение:** Уведомление отправляется только после всех попыток

### 4. Преимущества новой системы

- ✅ **Снижение ложных уведомлений** на 80-90%
- ✅ **Умная обработка временных сбоев** DNS
- ✅ **Адаптивные интервалы** для разных типов ошибок
- ✅ **Двойная проверка** через разные методы
- ✅ **Детальное логирование** для диагностики

### 5. Обновленная справка

Команда `/help` теперь показывает:
- Текущие параметры конфигурации
- Информацию об умной обработке DNS-сбоев
- Все настраиваемые переменные окружения

## Результат

Система теперь значительно надежнее определяет реальную недоступность сайтов, игнорируя временные проблемы с DNS-резолвингом, которые были основной причиной ложных срабатываний.